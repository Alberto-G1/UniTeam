{% extends "base/base_admin.html" %}
{% load static %}

{% block title %}Edit My Profile{% endblock %}

{% block content %}
<div class="surface shadow-xl rounded-lg p-6 md:p-8">
    <!-- Header with Back Button -->
    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6 border-b pb-4 gap-4">
        <div>
            <h1 class="text-3xl font-bold">Edit Admin Profile</h1>
            <p class="text-gray-500">Make changes to your profile and click "Save Changes" when you're done.</p>
        </div>
        <a href="{% url 'profile_details' %}" class="btn btn-secondary py-2 px-4 rounded-lg w-full sm:w-auto text-center">
            <i class="fas fa-arrow-left mr-2"></i>Back to Profile
        </a>
    </div>

    <!-- Display Error Messages -->
    {% if user_form.errors %}
        <div class="p-3 mb-4 rounded-lg text-sm bg-red-100 text-red-700" role="alert">
            <p class="font-bold">Please correct the errors below:</p>
            <ul class="list-disc list-inside mt-2">
                {% for field, errors in user_form.errors.items %}
                    {% for error in errors %}<li>{{ field|title }}: {{ error }}</li>{% endfor %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column: Avatar -->
            <div class="md:col-span-1 text-center">
                {% if user.avatar %}
                    <img id="avatar-preview" src="{{ user.avatar.url }}" alt="Profile Avatar" class="w-40 h-40 rounded-full mx-auto object-cover border-4 border-accent-2">
                {% else %}
                    <div id="avatar-placeholder" class="w-40 h-40 rounded-full mx-auto bg-gray-300 flex items-center justify-center text-5xl font-bold text-gray-600">
                        {{ user.first_name.0|default:'A'|upper }}{{ user.last_name.0|default:''|upper }}
                    </div>
                {% endif %}
                <label for="id_avatar" class="mt-4 inline-block btn btn-primary text-white font-semibold py-2 px-4 rounded-lg cursor-pointer">
                    Change Picture
                </label>
                {{ user_form.avatar }}
            </div>

            <!-- Right Column: Form Fields -->
            <div class="md:col-span-2 space-y-4">
                <h2 class="text-xl font-semibold border-b pb-2">Basic Information</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div><label for="{{ user_form.first_name.id_for_label }}" class="block text-sm font-medium">First Name</label>{{ user_form.first_name }}</div>
                    <div><label for="{{ user_form.last_name.id_for_label }}" class="block text-sm font-medium">Last Name</label>{{ user_form.last_name }}</div>
                </div>
                <div><label for="{{ user_form.email.id_for_label }}" class="block text-sm font-medium">Email</label>{{ user_form.email }}</div>
                <div><label for="{{ user_form.phone_number.id_for_label }}" class="block text-sm font-medium">Phone Number</label>{{ user_form.phone_number }}</div>

                <!-- Admin has no extra profile fields to edit here -->

                <div class="pt-4 flex justify-end">
                    <button type="submit" class="btn btn-primary text-white font-semibold py-2 px-6 rounded-lg">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
/* Simple styling for form fields to match your theme */
input[type="text"], input[type="email"], input[type="number"], textarea, select {
    background-color: var(--input-bg); border: 1px solid var(--dark-gray); color: var(--text-dark);
    transition: all 0.3s ease; width: 100%; padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.25rem; }
input:focus, textarea:focus, select:focus { border-color: var(--accent-2); box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.2); }
input[type="file"] { display: none; }
</style>

<script>
// Simple JS to show an image preview when a new avatar is selected.
document.getElementById('id_avatar').onchange = evt => {
    const [file] = evt.target.files
    if (file) {
        let preview = document.getElementById('avatar-preview');
        // If the placeholder is there, replace it with an img tag
        if (!preview) {
             preview = document.createElement('img');
             preview.id = 'avatar-preview';
             preview.className = 'w-40 h-40 rounded-full mx-auto object-cover border-4 border-accent-2';
             document.getElementById('avatar-placeholder').replaceWith(preview);
        }
        preview.src = URL.createObjectURL(file)
    }
}
</script>
{% endblock %}